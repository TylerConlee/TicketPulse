{{define "content"}}
<h1>Profile</h1>

<h2>Daily Summary Settings</h2>
<form method="POST" action="/profile/update-summary-settings">
    <div class="form-group">
        <label for="daily_summary">Enable Daily Summary:</label>
        <input type="checkbox" id="daily_summary" name="daily_summary" {{if .User.DailySummary}}checked{{end}}>
    </div>
    <div class="form-group">
        <label for="summary_time">Summary Time:</label>
        <input type="time" name="summary_time" value="{{.SummaryTime}}" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">Update Settings</button>
</form>

  <!-- New button to trigger on-demand summary -->
  <button type="button" id="on-demand-summary-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#summaryModal">
    Get Summary Now
</button>
<!-- Modal to display the summary -->
<div class="modal fade" id="summaryModal" tabindex="-1" aria-labelledby="summaryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="summaryModalLabel">Daily Summary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="summaryModalContent">Loading...</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<hr>

<h2>Tag Alerts</h2>
<form method="POST" action="/profile/add-tag">
    <div class="form-group">
        <label for="tag">Tag:</label>
        <input type="text" name="tag" id="tag" required class="form-control">
    </div>
    <div class="form-group">
        <label for="slack_channel">Slack Channel:</label>
        <select name="slack_channel" id="slack_channel" required class="form-control">
            {{range .SlackChannels}}
            <option value="{{.ID}}">{{.Name}}</option>
            {{end}}
        </select>
    </div>
    <div class="form-group">
        <label for="alert_type">Alert Type:</label>
        <select name="alert_type" id="alert_type" required class="form-control">
            <option value="new_ticket">New Ticket</option>
            <option value="sla_deadline">SLA Deadline</option>
            <option value="ticket_update">Ticket Update</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Add Tag Alert</button>
</form>

<h2>Configured Alerts</h2>
<table class="table">
    <thead>
        <tr>
            <th>Tag</th>
            <th>Slack Channel</th>
            <th>Alert Type</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {{range .TagAlerts}}
        <tr>
            <td>{{.Tag}}</td>
            <td>{{.SlackChannelID}}</td>
            <td>{{.AlertType}}</td>
            <td>
                <form method="POST" action="/profile/delete-tag/{{.ID}}" onsubmit="return confirm('Are you sure you want to delete this alert?');">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}
